<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Predictions - Health Companion</title>
    <style>
        :root {
            --bg1: #081625;
            --bg2: #10253f;
            --card: rgba(15, 23, 42, 0.78);
            --border: rgba(255,255,255,0.13);
            --muted: #94a3b8;
            --text: #e2e8f0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background: radial-gradient(circle at top left, var(--bg2), var(--bg1) 70%); color: var(--text); }
        .nav { position: sticky; top: 0; z-index: 20; display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 14px 20px; background: rgba(7, 12, 24, 0.75); border-bottom: 1px solid var(--border); backdrop-filter: blur(10px); flex-wrap: wrap; }
        .brand { color: #22d3ee; font-weight: 800; }
        .nav-links { display: flex; gap: 8px; flex-wrap: wrap; }
        .nav a { color: var(--text); text-decoration: none; font-size: 13px; padding: 8px 12px; border: 1px solid var(--border); border-radius: 10px; background: rgba(255,255,255,0.06); }
        .wrap { max-width: 1280px; margin: 18px auto; padding: 0 16px 24px; }
        .header h1 { color: #fff; font-size: 26px; }
        .header p { margin-top: 6px; color: var(--muted); font-size: 14px; }
        .msg { margin-top: 12px; padding: 10px 12px; border-radius: 10px; font-size: 13px; border: 1px solid transparent; }
        .msg.success { background: rgba(16,185,129,.18); border-color: rgba(16,185,129,.4); color: #6ee7b7; }
        .msg.error { background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.4); color: #fecaca; }
        .panel { margin-top: 14px; background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px; overflow-x: auto; }
        .panel h2 { font-size: 18px; margin-bottom: 10px; }
        .controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        select, button {
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(2,6,23,.55);
            color: #fff;
            padding: 10px;
            font-size: 13px;
        }
        button { background: #ef4444; border-color: rgba(239,68,68,.55); font-weight: 700; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 11px 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,.08); font-size: 13px; white-space: nowrap; }
        th { color: var(--muted); }
        .chip { display: inline-block; padding: 4px 8px; border-radius: 999px; font-size: 11px; border: 1px solid rgba(255,255,255,.2); }
    </style>
</head>
<body>
<div class="nav">
    <div class="brand">Health Companion Admin</div>
    <div class="nav-links">
        <a href="{{ url_for('admin_dashboard') }}">Overview</a>
        <a href="{{ url_for('admin_users') }}">Users</a>
        <a href="{{ url_for('admin_predictions') }}">Predictions</a>
        <a href="{{ url_for('admin_logs') }}">Logs</a>
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>
</div>

<div class="wrap">
    <div class="header">
        <h1>Prediction Data Management</h1>
        <p>Monitor recent risk assessments and clear history safely by model scope.</p>
        {% if msg %}
        <div class="msg {{ 'success' if status == 'success' else 'error' }}">{{ msg }}</div>
        {% endif %}
    </div>

    <div class="panel">
        <h2>Clear Prediction History</h2>
        <form method="post" action="{{ url_for('admin_clear_predictions') }}" class="controls" onsubmit="return confirm('Clear selected prediction history? This cannot be undone.');">
            <input type="hidden" name="confirm" value="yes">
            <select name="scope">
                <option value="all">All Predictions</option>
                <option value="stroke">Stroke Only</option>
                <option value="diabetes">Diabetes Only</option>
                <option value="cardiovascular">Cardiovascular Only</option>
            </select>
            <button type="submit">Clear History</button>
        </form>
    </div>

    <div class="panel">
        <h2>Recent Predictions</h2>
        <table>
            <thead>
                <tr>
                    <th>Model</th>
                    <th>User</th>
                    <th>Risk Level</th>
                    <th>Probability</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for row in predictions %}
                <tr>
                    <td><span class="chip">{{ row.model_type }}</span></td>
                    <td>{{ row.username }}</td>
                    <td>{{ row.risk_level }}</td>
                    <td>{{ (row.probability * 100)|round(1) if row.probability is not none else 'N/A' }}%</td>
                    <td>{{ row.assessment_date }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
