<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Users - Health Companion</title>
    <style>
        :root {
            --bg1: #081625;
            --bg2: #10253f;
            --card: rgba(15, 23, 42, 0.78);
            --border: rgba(255,255,255,0.13);
            --muted: #94a3b8;
            --text: #e2e8f0;
            --accent: #22d3ee;
            --ok: #10b981;
            --bad: #ef4444;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: radial-gradient(circle at top left, var(--bg2), var(--bg1) 70%);
            color: var(--text);
            min-height: 100vh;
        }
        .nav {
            position: sticky;
            top: 0;
            z-index: 20;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: rgba(7, 12, 24, 0.75);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }
        .brand { color: var(--accent); font-weight: 800; }
        .nav-links { display: flex; gap: 8px; flex-wrap: wrap; }
        .nav a {
            color: var(--text);
            text-decoration: none;
            font-size: 13px;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: rgba(255,255,255,0.06);
        }
        .wrap { max-width: 1300px; margin: 18px auto; padding: 0 16px 24px; }
        .header { margin-bottom: 14px; }
        .header h1 { font-size: 28px; color: #fff; }
        .header p { margin-top: 6px; color: var(--muted); font-size: 14px; }
        .msg {
            margin-top: 12px;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 13px;
            border: 1px solid transparent;
        }
        .msg.success { background: rgba(16,185,129,.18); border-color: rgba(16,185,129,.4); color: #6ee7b7; }
        .msg.error { background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.4); color: #fecaca; }
        .panel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px;
            overflow: auto;
        }
        .toolbar {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .toolbar input {
            width: 280px;
            max-width: 100%;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(2, 6, 23, 0.55);
            color: #fff;
            padding: 10px;
            font-size: 13px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td {
            padding: 11px 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,.08);
            font-size: 13px;
            white-space: nowrap;
        }
        th { color: var(--muted); font-weight: 700; }
        .pill {
            padding: 4px 8px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
            display: inline-block;
            border: 1px solid transparent;
        }
        .role-admin { background: rgba(34,211,238,.16); color: #67e8f9; border-color: rgba(34,211,238,.35); }
        .role-user { background: rgba(148,163,184,.18); color: #cbd5e1; border-color: rgba(148,163,184,.35); }
        .state-active { background: rgba(16,185,129,.18); color: #6ee7b7; border-color: rgba(16,185,129,.35); }
        .state-inactive { background: rgba(239,68,68,.18); color: #fecaca; border-color: rgba(239,68,68,.35); }
        .btn-link {
            color: var(--text);
            text-decoration: none;
            font-size: 12px;
            border: 1px solid var(--border);
            padding: 7px 10px;
            border-radius: 8px;
            background: rgba(255,255,255,.06);
        }
    </style>
</head>
<body>
    <div class="nav">
        <div class="brand">Health Companion Admin</div>
        <div class="nav-links">
            <a href="{{ url_for('admin_dashboard') }}">Overview</a>
            <a href="{{ url_for('admin_users') }}">Users</a>
            <a href="{{ url_for('admin_predictions') }}">Predictions</a>
            <a href="{{ url_for('admin_logs') }}">Logs</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>

    <div class="wrap">
        <div class="header">
            <h1>User Management</h1>
            <p>View all accounts, inspect profile state, and open detailed management actions.</p>
            {% if msg %}
            <div class="msg {{ 'success' if status == 'success' else 'error' }}">{{ msg }}</div>
            {% endif %}
        </div>

        <div class="panel">
            <div class="toolbar">
                <strong>Total Users: {{ users|length }}</strong>
                <input id="userSearch" type="text" placeholder="Search by username or email">
            </div>

            <table id="usersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Profile</th>
                        <th>Created</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td><span class="pill {{ 'role-admin' if user.role == 'admin' else 'role-user' }}">{{ user.role }}</span></td>
                        <td><span class="pill {{ 'state-active' if user.is_active == 1 else 'state-inactive' }}">{{ 'Active' if user.is_active == 1 else 'Inactive' }}</span></td>
                        <td>{{ 'Complete' if user.profile_complete == 1 else 'Incomplete' }}</td>
                        <td>{{ user.created_at }}</td>
                        <td><a class="btn-link" href="{{ url_for('admin_user_profile', target_user_id=user.id) }}">Manage</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

<script>
const search = document.getElementById('userSearch');
const rows = Array.from(document.querySelectorAll('#usersTable tbody tr'));
search.addEventListener('input', () => {
  const q = search.value.toLowerCase().trim();
  rows.forEach((row) => {
    const txt = row.textContent.toLowerCase();
    row.style.display = txt.includes(q) ? '' : 'none';
  });
});
</script>
</body>
</html>
