<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Profile - Health Companion</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: radial-gradient(circle at top left, #0b223a, #081625 70%);
            color: #e5e7eb;
        }

        .navbar {
            position: sticky;
            top: 0;
            z-index: 200;
            background: rgba(10, 25, 41, 0.75);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(34, 211, 238, 0.25);
            padding: 16px 24px;
        }

        .navbar-inner {
            max-width: 1400px;
            margin: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 800;
            color: #22d3ee;
        }

        .nav-links {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #e2e8f0;
            font-size: 13px;
            font-weight: 600;
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(255, 255, 255, 0.08);
            transition: all 0.2s ease;
        }

        .nav-links a:hover {
            transform: translateY(-1px);
            border-color: rgba(34, 211, 238, 0.45);
            color: #22d3ee;
        }

        .logout-btn {
            border-color: rgba(248, 113, 113, 0.45) !important;
            color: #fecaca !important;
        }

        .profile-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 28px 20px 44px;
        }

        .page-header {
            margin-bottom: 18px;
        }

        .page-header h1 {
            color: #fff;
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.7px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-header p {
            margin-top: 8px;
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.6;
            max-width: 860px;
        }

        .first-time-banner,
        .message {
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 16px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .first-time-banner {
            background: rgba(59, 130, 246, 0.18);
            border: 1px solid rgba(96, 165, 250, 0.55);
            color: #dbeafe;
        }

        .message.success {
            background: rgba(16, 185, 129, 0.16);
            border: 1px solid rgba(52, 211, 153, 0.55);
            color: #d1fae5;
        }

        .message.error {
            background: rgba(239, 68, 68, 0.16);
            border: 1px solid rgba(248, 113, 113, 0.55);
            color: #fee2e2;
        }

        .profile-card {
            background: rgba(15, 23, 42, 0.66);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 18px;
            padding: 24px;
        }

        .form-section {
            margin-bottom: 24px;
        }

        .form-section h3 {
            font-size: 17px;
            color: #fff;
            font-weight: 800;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-subtitle {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 14px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 14px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        label {
            font-size: 12px;
            font-weight: 700;
            color: #cbd5e1;
        }

        .required-label::after {
            content: " *";
            color: #fda4af;
        }

        input,
        select {
            width: 100%;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(2, 6, 23, 0.55);
            color: #f8fafc;
            padding: 11px 12px;
            font-size: 13px;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: rgba(34, 211, 238, 0.6);
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.15);
        }

        input[readonly] {
            background: rgba(15, 23, 42, 0.8);
            color: #67e8f9;
            font-weight: 700;
        }

        .calc-note {
            margin-top: 8px;
            color: #94a3b8;
            font-size: 11px;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .btn {
            text-decoration: none;
            border: none;
            border-radius: 10px;
            padding: 11px 16px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-primary {
            color: #06212e;
            background: linear-gradient(90deg, #06b6d4, #22d3ee);
        }

        .btn-secondary {
            color: #e2e8f0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        @media (max-width: 1100px) {
            .form-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }

        @media (max-width: 700px) {
            .nav-links { display: none; }
            .profile-card { padding: 16px; }
            .form-grid { grid-template-columns: 1fr; }
            .page-header h1 { font-size: 25px; }
        }
    </style>
</head>
<body>
<nav class="navbar">
    <div class="navbar-inner">
        <div class="brand">
            <i class="fas fa-heartbeat"></i>
            <span>Health Companion</span>
        </div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}"><i class="fas fa-home"></i> Dashboard</a>
            <a href="{{ url_for('report') }}"><i class="fas fa-file-medical"></i> Report</a>
            {% if is_admin_user %}
            <a href="{{ url_for('admin_dashboard') }}"><i class="fas fa-shield-alt"></i> Admin Panel</a>
            {% else %}
            <a href="/admin-login"><i class="fas fa-user-shield"></i> Admin Login</a>
            {% endif %}
            <a href="{{ url_for('logout') }}" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>
</nav>

<main class="profile-container">
    <header class="page-header">
        <h1><i class="fas fa-user-circle"></i> Health Profile</h1>
        <p>Enter your complete health profile once. All Stroke, Cardio, and Diabetes predictions will use this saved data automatically.</p>
    </header>

    {% if first_time %}
    <div class="first-time-banner">
        <i class="fas fa-info-circle"></i>
        <strong>Welcome.</strong> Complete your profile to unlock the dashboard and personalized predictions.
    </div>
    {% endif %}

    {% if msg %}
        <div class="message {{ 'success' if 'successfully' in msg.lower() else 'error' }}">
            <i class="fas {{ 'fa-check-circle' if 'successfully' in msg.lower() else 'fa-exclamation-circle' }}"></i>
            {{ msg }}
        </div>
    {% endif %}

    <section class="profile-card">
        <form method="POST" action="{{ url_for('profile') }}">
            <section class="form-section">
                <h3><i class="fas fa-user"></i> Personal Information</h3>
                <p class="section-subtitle">Core demographics used across all risk models.</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required-label" for="age">Age (years)</label>
                        <input id="age" name="age" type="number" min="1" max="120" required value="{{ profile.age if profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="gender">Gender</label>
                        <select id="gender" name="gender" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="1" {% if profile and profile.gender == 1 %}selected{% endif %}>Male</option>
                            <option value="0" {% if profile and profile.gender == 0 %}selected{% endif %}>Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="ever_married">Ever Married</label>
                        <select id="ever_married" name="ever_married" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="1" {% if profile and profile.ever_married == 1 %}selected{% endif %}>Yes</option>
                            <option value="0" {% if profile and profile.ever_married == 0 %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="residence_type">Residence Type</label>
                        <select id="residence_type" name="residence_type" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="1" {% if profile and profile.residence_type == 1 %}selected{% endif %}>Urban</option>
                            <option value="0" {% if profile and profile.residence_type == 0 %}selected{% endif %}>Rural</option>
                        </select>
                    </div>
                </div>
            </section>

            <section class="form-section">
                <h3><i class="fas fa-ruler-combined"></i> Body Measurements</h3>
                <p class="section-subtitle">BMI and BMR are computed dynamically from age, sex, height, and weight.</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required-label" for="height">Height (cm)</label>
                        <input id="height" name="height" type="number" min="50" max="280" step="0.1" required value="{{ profile.height if profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="weight">Weight (kg)</label>
                        <input id="weight" name="weight" type="number" min="10" max="400" step="0.1" required value="{{ profile.weight if profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="bmi_display">BMI (auto)</label>
                        <input id="bmi_display" type="text" readonly value="{{ profile.bmi|round(2) if profile and profile.bmi else '' }}">
                        <input id="bmi" name="bmi" type="hidden" value="{{ profile.bmi|round(2) if profile and profile.bmi else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="bmr_display">BMR kcal/day (auto)</label>
                        <input id="bmr_display" type="text" readonly value="{{ bmr_value if bmr_value else '' }}">
                    </div>
                </div>
                <p class="calc-note">BMR is for awareness; BMI is stored and used by models.</p>
            </section>

            <section class="form-section">
                <h3><i class="fas fa-running"></i> Lifestyle Habits</h3>
                <p class="section-subtitle">Lifestyle factors used in cardio and stroke risk estimation.</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required-label" for="smoking_status">Smoking Status</label>
                        <select id="smoking_status" name="smoking_status" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="0" {% if profile and profile.smoking_status == 0 %}selected{% endif %}>Never</option>
                            <option value="1" {% if profile and profile.smoking_status == 1 %}selected{% endif %}>Current</option>
                            <option value="2" {% if profile and profile.smoking_status == 2 %}selected{% endif %}>Former</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="alcohol_consumption">Alcohol Consumption</label>
                        <select id="alcohol_consumption" name="alcohol_consumption" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="1" {% if profile and profile.alcohol_consumption == 1 %}selected{% endif %}>Yes</option>
                            <option value="0" {% if profile and profile.alcohol_consumption == 0 %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="physical_activity">Physically Active</label>
                        <select id="physical_activity" name="physical_activity" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="1" {% if profile and profile.physical_activity == 1 %}selected{% endif %}>Yes</option>
                            <option value="0" {% if profile and profile.physical_activity == 0 %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="work_type">Work Type</label>
                        <select id="work_type" name="work_type" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="0" {% if profile and profile.work_type == 0 %}selected{% endif %}>Private</option>
                            <option value="1" {% if profile and profile.work_type == 1 %}selected{% endif %}>Self-employed</option>
                            <option value="2" {% if profile and profile.work_type == 2 %}selected{% endif %}>Government Job</option>
                            <option value="3" {% if profile and profile.work_type == 3 %}selected{% endif %}>Children</option>
                            <option value="4" {% if profile and profile.work_type == 4 %}selected{% endif %}>Never Worked</option>
                        </select>
                    </div>
                </div>
            </section>

            <section class="form-section">
                <h3><i class="fas fa-notes-medical"></i> Medical History</h3>
                <p class="section-subtitle">Condition history relevant to stroke, diabetes, and cardiovascular models.</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required-label" for="hypertension">Hypertension</label>
                        <select id="hypertension" name="hypertension" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="1" {% if profile and profile.hypertension == 1 %}selected{% endif %}>Yes</option>
                            <option value="0" {% if profile and profile.hypertension == 0 %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="heart_disease">Heart Disease</label>
                        <select id="heart_disease" name="heart_disease" required>
                            <option value="" disabled {% if not profile %}selected{% endif %}>Select</option>
                            <option value="1" {% if profile and profile.heart_disease == 1 %}selected{% endif %}>Yes</option>
                            <option value="0" {% if profile and profile.heart_disease == 0 %}selected{% endif %}>No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pregnancies">Pregnancies</label>
                        <input id="pregnancies" name="pregnancies" type="number" min="0" max="20" value="{{ profile.pregnancies if profile else 0 }}">
                    </div>
                </div>
            </section>

            <section class="form-section">
                <h3><i class="fas fa-flask"></i> Clinical Values</h3>
                <p class="section-subtitle">Numeric lab and vitals values used for model input mapping.</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required-label" for="blood_pressure_systolic">Systolic BP (mmHg)</label>
                        <input id="blood_pressure_systolic" name="blood_pressure_systolic" type="number" min="70" max="250" required value="{{ profile.blood_pressure_systolic if profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="blood_pressure_diastolic">Diastolic BP (mmHg)</label>
                        <input id="blood_pressure_diastolic" name="blood_pressure_diastolic" type="number" min="40" max="150" required value="{{ profile.blood_pressure_diastolic if profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="glucose_level">Glucose (mg/dL)</label>
                        <input id="glucose_level" name="glucose_level" type="number" min="40" max="600" required value="{{ profile.glucose_level if profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label class="required-label" for="cholesterol">Cholesterol (mg/dL)</label>
                        <input id="cholesterol" name="cholesterol" type="number" min="80" max="500" required value="{{ profile.cholesterol if profile else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="insulin">Insulin</label>
                        <input id="insulin" name="insulin" type="number" min="0" max="1000" value="{{ profile.insulin if profile else 0 }}">
                    </div>
                    <div class="form-group">
                        <label for="skin_thickness">Skin Thickness</label>
                        <input id="skin_thickness" name="skin_thickness" type="number" min="0" max="100" value="{{ profile.skin_thickness if profile else 0 }}">
                    </div>
                    <div class="form-group">
                        <label for="diabetes_pedigree_function">Diabetes Pedigree Function</label>
                        <input id="diabetes_pedigree_function" name="diabetes_pedigree_function" type="number" min="0" max="3" step="0.01" value="{{ profile.diabetes_pedigree_function if profile else 0 }}">
                    </div>
                </div>
            </section>

            <div class="button-group">
                <a href="{{ url_for('landing') }}" class="btn btn-secondary">Back to Landing</a>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Profile & Continue</button>
            </div>
        </form>
    </section>
</main>

<script>
(function () {
    const fields = {
        age: document.getElementById('age'),
        gender: document.getElementById('gender'),
        height: document.getElementById('height'),
        weight: document.getElementById('weight'),
        bmiDisplay: document.getElementById('bmi_display'),
        bmiHidden: document.getElementById('bmi'),
        bmrDisplay: document.getElementById('bmr_display')
    };

    function calculateBMI() {
        const height = parseFloat(fields.height.value);
        const weight = parseFloat(fields.weight.value);
        if (!height || !weight || height <= 0) {
            fields.bmiDisplay.value = '';
            fields.bmiHidden.value = '';
            return;
        }
        const meters = height / 100;
        const bmi = weight / (meters * meters);
        fields.bmiDisplay.value = bmi.toFixed(2);
        fields.bmiHidden.value = bmi.toFixed(2);
    }

    function calculateBMR() {
        const age = parseFloat(fields.age.value);
        const height = parseFloat(fields.height.value);
        const weight = parseFloat(fields.weight.value);
        const gender = fields.gender.value;

        if (!age || !height || !weight || (gender !== '0' && gender !== '1')) {
            fields.bmrDisplay.value = '';
            return;
        }

        let bmr = 0;
        if (gender === '1') {
            bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
        } else {
            bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
        }
        fields.bmrDisplay.value = Math.round(bmr);
    }

    function recalc() {
        calculateBMI();
        calculateBMR();
    }

    ['input', 'change'].forEach((eventType) => {
        fields.age.addEventListener(eventType, recalc);
        fields.gender.addEventListener(eventType, recalc);
        fields.height.addEventListener(eventType, recalc);
        fields.weight.addEventListener(eventType, recalc);
    });

    recalc();
})();
</script>
</body>
</html>
